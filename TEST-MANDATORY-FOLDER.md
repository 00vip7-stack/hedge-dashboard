# 🧪 테스트 가이드 - 강제 폴더 설정 모달

## 테스트 방법

### 1. 최초 실행 시나리오 테스트

브라우저 콘솔(F12)에서 다음 명령어 실행:

```javascript
// 로컬 스토리지 초기화 (최초 실행 상태로 되돌림)
localStorage.clear();

// IndexedDB 초기화 (폴더 권한 삭제)
indexedDB.deleteDatabase('HedgeDashboardDB');

// 페이지 새로고침
location.reload();
```

### 2. 예상 동작

1. **페이지 로드**
   - 자동으로 폴더 핸들 복구 시도
   - 실패하면 🚨 강제 폴더 설정 모달 표시

2. **강제 모달 내용**
   - 닫기 버튼 없음 (무조건 설정해야 함)
   - "원본" 폴더 선택 버튼
   - "결과" 폴더 선택 버튼
   - 완료 버튼 (처음엔 비활성화)

3. **폴더 선택 과정**
   ```
   [📁 "원본" 폴더 선택] 클릭
     ↓
   브라우저 폴더 선택 다이얼로그 표시
     ↓
   C:\Users\...\Documents\HEDGEFREEDOM\원본 선택
     ↓
   ✅ 버튼 변경: "✅ 원본 선택됨"
   
   [📁 "결과" 폴더 선택] 클릭
     ↓
   C:\Users\...\Documents\HEDGEFREEDOM\결과 선택
     ↓
   ✅ 버튼 변경: "✅ 결과 선택됨"
     ↓
   🎉 완료 버튼 활성화
   ```

4. **설정 완료**
   ```
   [✅ 설정 완료 및 시작하기] 클릭
     ↓
   localStorage에 'hedge_folders_setup' 저장
     ↓
   IndexedDB에 폴더 핸들 저장
     ↓
   "🎯 초기 설정" 모달 표시 (목표 헤지 비율)
     ↓
   목표 비율 입력 (예: 75%)
     ↓
   [설정 완료 및 대시보드 시작] 클릭
     ↓
   ✅ 대시보드 표시
   ```

### 3. 재로그인 시나리오

```javascript
// 페이지 새로고침만
location.reload();
```

**예상 동작:**
- 자동으로 폴더 권한 복구 성공
- 강제 모달 **표시 안 됨**
- "결과" 폴더에서 latest_*.json 자동 불러오기
- 대시보드에 지난 결과 즉시 표시

### 4. 폴더 선택 취소 시

```
[📁 "원본" 폴더 선택] 클릭
  ↓
브라우저 다이얼로그에서 [취소] 클릭
  ↓
경고 메시지: "폴더 선택이 취소되었습니다. '원본' 폴더를 선택해야 계속 진행할 수 있습니다."
  ↓
모달 계속 표시 (닫히지 않음)
```

### 5. 잘못된 브라우저 사용 시

Safari, Firefox 등에서 접속 시:

```
폴더 선택 실패: 이 브라우저는 폴더 선택을 지원하지 않습니다. 
Chrome/Edge를 사용해주세요.
```

## 체크리스트

- [ ] 최초 실행 시 강제 모달 표시됨
- [ ] 닫기 버튼 없음 (ESC로도 닫히지 않음)
- [ ] "원본" 폴더 선택 시 상태 업데이트
- [ ] "결과" 폴더 선택 시 상태 업데이트
- [ ] 두 폴더 선택 완료 시 완료 버튼 활성화
- [ ] 완료 버튼 클릭 시 초기 설정 모달로 이동
- [ ] localStorage 및 IndexedDB에 저장됨
- [ ] 재로그인 시 모달 표시 안 됨
- [ ] 재로그인 시 폴더에서 데이터 자동 불러오기

## 파일 상단 규칙 확인

hedge-manager.html 파일을 열고 상단 주석 확인:

```html
<!--
╔═══════════════════════════════════════════════════════════════════════════════╗
║                    📂 HedgeFreedom 데이터 파이프라인 규칙                          ║
║                           (이 규칙은 절대 변경 금지)                              ║
╚═══════════════════════════════════════════════════════════════════════════════╝
...
-->
```

- [ ] 규칙이 파일 상단에 표시됨
- [ ] 7단계 워크플로우 명시됨
- [ ] 보안 규칙 명시됨
- [ ] 중요 공지 명시됨

## 디버깅

브라우저 콘솔에서 확인할 로그:

```
📊 헤지매니저 v3.0 로드 (모듈화)
✅ 페이지 로드 완료
ℹ️ 저장된 폴더 없음 (최초 실행)
🚨 폴더 설정 필요 - 강제 모달 표시
🚨 강제 폴더 설정 모달 표시됨
📁 "원본" 폴더 선택 시작...
✅ 폴더 핸들 저장 완료: 원본
📁 "결과" 폴더 선택 시작...
✅ 폴더 핸들 저장 완료: 결과
✅ 두 폴더 모두 설정 완료
✅ 필수 폴더 설정 완료 - 초기 설정으로 이동
```

---

**작성일:** 2026-02-04  
**버전:** v3.0
