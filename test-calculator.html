<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê³„ì‚°ê¸° API í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 900px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        .subtitle {
            color: #7f8c8d;
            margin-bottom: 30px;
        }
        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        button:hover {
            background: #2980b9;
        }
        button:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
        }
        .result-box {
            background: #ecf0f1;
            padding: 20px;
            border-radius: 5px;
            margin-top: 20px;
            display: none;
        }
        .result-box.show {
            display: block;
        }
        .result-box h3 {
            margin-top: 0;
            color: #2c3e50;
        }
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 15px;
        }
        .kpi-item {
            background: white;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #3498db;
        }
        .kpi-label {
            font-size: 12px;
            color: #7f8c8d;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .kpi-value {
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
            margin-top: 5px;
        }
        .kpi-unit {
            font-size: 14px;
            color: #95a5a6;
        }
        .recommendation {
            grid-column: 1 / -1;
            background: #2ecc71;
            color: white;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
        }
        .recommendation.warning {
            background: #e74c3c;
        }
        .recommendation.normal {
            background: #2ecc71;
        }
        .calculator-info {
            margin-top: 15px;
            padding: 10px;
            background: #3498db;
            color: white;
            border-radius: 5px;
            font-size: 12px;
        }
        pre {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            font-size: 12px;
        }
        .loading {
            text-align: center;
            padding: 20px;
            color: #7f8c8d;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§® ì„œë²„ ê³„ì‚°ê¸° í…ŒìŠ¤íŠ¸</h1>
        <p class="subtitle">í”ŒëŸ¬ê·¸ì¸ êµ¬ì¡° ê¸°ë°˜ í™•ì¥ ê°€ëŠ¥í•œ ê³„ì‚°ê¸° ì‹œìŠ¤í…œ</p>

        <div>
            <button onclick="testCalculator()">ê³„ì‚° í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
            <button onclick="testMultiplePositions()">ë‹¤ì¤‘ í¬ì§€ì…˜ í…ŒìŠ¤íŠ¸</button>
            <button onclick="clearResults()">ê²°ê³¼ ì§€ìš°ê¸°</button>
        </div>

        <div id="result" class="result-box">
            <h3>ğŸ“Š ê³„ì‚° ê²°ê³¼</h3>
            <div id="kpiGrid" class="kpi-grid"></div>
            <div id="calculatorInfo" class="calculator-info"></div>
        </div>

        <div id="rawData" class="result-box">
            <h3>ğŸ“‹ ì›ì‹œ ë°ì´í„° (ê°œë°œììš©)</h3>
            <pre id="jsonOutput"></pre>
        </div>
    </div>

    <script>
        const API_BASE = '';  // ê°™ì€ ì„œë²„

        async function testCalculator() {
            showLoading();
            
            const testData = {
                positions: [
                    {currency: 'USD', amount: 100000, direction: 'hedge', rate: 1350.50},
                    {currency: 'USD', amount: 50000, direction: 'hedge', rate: 1348.20},
                    {currency: 'USD', amount: 80000, direction: 'exposure', rate: 1352.00}
                ],
                customerId: 'TEST001',
                saveResults: false
            };

            try {
                const response = await fetch(API_BASE + '/api/hedge/calculate', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(testData)
                });

                const result = await response.json();
                displayResults(result);
            } catch (error) {
                alert('ì˜¤ë¥˜: ' + error.message);
            }
        }

        async function testMultiplePositions() {
            showLoading();
            
            const testData = {
                positions: [
                    {currency: 'USD', amount: 500000, direction: 'hedge', rate: 1350.00},
                    {currency: 'USD', amount: 300000, direction: 'hedge', rate: 1348.50},
                    {currency: 'USD', amount: 200000, direction: 'hedge', rate: 1352.20},
                    {currency: 'EUR', amount: 150000, direction: 'exposure', rate: 1450.00},
                    {currency: 'USD', amount: 100000, direction: 'exposure', rate: 1351.00}
                ],
                customerId: 'TEST002',
                saveResults: false
            };

            try {
                const response = await fetch(API_BASE + '/api/hedge/calculate', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(testData)
                });

                const result = await response.json();
                displayResults(result);
            } catch (error) {
                alert('ì˜¤ë¥˜: ' + error.message);
            }
        }

        function showLoading() {
            document.getElementById('result').classList.add('show');
            document.getElementById('kpiGrid').innerHTML = '<div class="loading">ê³„ì‚° ì¤‘...</div>';
        }

        function displayResults(result) {
            if (!result.success) {
                alert('ê³„ì‚° ì‹¤íŒ¨: ' + result.error);
                return;
            }

            const kpi = result.kpi;
            const kpiGrid = document.getElementById('kpiGrid');
            
            // KPI í‘œì‹œ
            kpiGrid.innerHTML = `
                <div class="kpi-item">
                    <div class="kpi-label">ì´ ë…¸ì¶œì•¡</div>
                    <div class="kpi-value">${formatNumber(kpi.totalExposure)} <span class="kpi-unit">ì›</span></div>
                </div>
                <div class="kpi-item">
                    <div class="kpi-label">í—¤ì§€ëœ ê¸ˆì•¡</div>
                    <div class="kpi-value">${formatNumber(kpi.hedgedAmount)} <span class="kpi-unit">ì›</span></div>
                </div>
                <div class="kpi-item">
                    <div class="kpi-label">í—¤ì§€ ë¹„ìœ¨</div>
                    <div class="kpi-value">${kpi.hedgeRatio} <span class="kpi-unit">%</span></div>
                </div>
                <div class="kpi-item">
                    <div class="kpi-label">ë¯¸í—¤ì§€ ê¸ˆì•¡</div>
                    <div class="kpi-value">${formatNumber(kpi.unhedgedGap)} <span class="kpi-unit">ì›</span></div>
                </div>
                <div class="kpi-item">
                    <div class="kpi-label">í‰ê·  í—¤ì§€ í™˜ìœ¨</div>
                    <div class="kpi-value">${kpi.avgHedgeRate} <span class="kpi-unit">ì›/ë‹¬ëŸ¬</span></div>
                </div>
                <div class="kpi-item recommendation ${getRecommendationClass(kpi.recommendation)}">
                    ${kpi.recommendation}
                </div>
            `;

            // ê³„ì‚°ê¸° ì •ë³´
            document.getElementById('calculatorInfo').innerHTML = `
                <strong>ê³„ì‚°ê¸° ì‹œìŠ¤í…œ:</strong> ë²„ì „ ${result.calculatorInfo.version} | 
                ë“±ë¡ëœ ê³„ì‚°ê¸°: ${result.calculatorInfo.totalCalculators}ê°œ 
                [${result.calculatorInfo.calculators.join(', ')}]
            `;

            // Raw ë°ì´í„°
            document.getElementById('jsonOutput').textContent = JSON.stringify(result, null, 2);
            document.getElementById('result').classList.add('show');
            document.getElementById('rawData').classList.add('show');
        }

        function getRecommendationClass(rec) {
            if (rec === 'ì ì •') return 'normal';
            return 'warning';
        }

        function formatNumber(num) {
            return Math.round(num).toLocaleString('ko-KR');
        }

        function clearResults() {
            document.getElementById('result').classList.remove('show');
            document.getElementById('rawData').classList.remove('show');
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ í…ŒìŠ¤íŠ¸ (ì„ íƒì )
        // window.addEventListener('load', testCalculator);
    </script>
</body>
</html>
