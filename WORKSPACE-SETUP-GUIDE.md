# 🎯 작업공간 설정 가이드

## 개요
HedgeFreedom은 고객이 **처음 시작할 때 단 한 번만 폴더를 지정**하는 방식으로 작업공간을 설정합니다.  
고객이 최상위 폴더만 선택하면, 시스템이 자동으로 필요한 폴더 구조를 생성합니다.

---

## 🔑 핵심 철학

### "우리 데이터는 우리가 관리한다"
1. **데이터 주권**: 민감한 거래처/은행 정보는 고객 PC에만 보관
2. **최소 전송**: 서버에는 통화/금액/날짜만 전송 (거래처명 제외)
3. **자동 복원**: 다음 로그인 시 자동으로 데이터 복원
4. **간편 설정**: 폴더 하나만 선택하면 모든 구조 자동 생성

---

## 📂 자동 생성되는 폴더 구조

고객이 선택한 폴더 안에 다음 구조가 자동으로 생성됩니다:

```
[선택한 폴더] (예: Documents)
└── HEDGEFREEDOM/        ← 자동 생성
    ├── 원본/            ← ERP에서 다운로드한 Excel 파일
    ├── 결과/            ← 익명화된 데이터 + 계산 결과
    ├── 히스토리/        ← 과거 데이터 백업
    └── 캐시/            ← 임시 파일
```

### 각 폴더의 역할
- **원본**: ERP에서 다운받은 Excel 파일 원본 보관 (절대 서버 전송 안 됨)
- **결과**: 익명화 처리된 데이터 + 헤지 계산 결과 (자동 저장/로딩)
- **히스토리**: 과거 데이터 백업 (감사 대응용)
- **캐시**: 임시 파일 및 중간 처리 데이터

---

## 🚀 사용자 워크플로우

### 1단계: 작업 폴더 선택
```
고객 작업:
- "📁 작업 폴더 선택하기" 버튼 클릭
- 원하는 최상위 폴더 선택 (예: Documents, Desktop 등)

시스템 작업:
- HEDGEFREEDOM 폴더 자동 생성
- 하위 폴더 4개 자동 생성 (원본, 결과, 히스토리, 캐시)
- 폴더 핸들을 IndexedDB에 저장
```

### 2단계: 설정 완료
```
시스템 작업:
- "✅ 설정 완료 및 시작하기" 버튼 활성화
- 고객이 클릭하면 목표 헤지 비율 설정 모달로 이동
```

### 3단계: 자동 데이터 관리
```
이후 자동 처리:
- Excel 업로드 시 → 원본 폴더에 저장
- 익명화 처리 후 → 결과 폴더에 저장
- 다음 로그인 시 → 결과 폴더에서 자동 로딩
```

---

## 🔄 데이터 처리 흐름

```
┌─────────────────────────────────────────────────────────────┐
│ 1. ERP Excel 업로드 → 원본 폴더에 저장                     │
│                                                               │
│ 2. 거래처/은행 정보 자동 제거 (마스킹)                      │
│                                                               │
│ 3. 통화/금액/날짜만 서버로 전송 → 헤지 계산                 │
│                                                               │
│ 4. 계산 결과 → 결과 폴더에 자동 저장                        │
│                                                               │
│ 5. 다음 로그인 시 → 결과 폴더에서 자동 복원                 │
└─────────────────────────────────────────────────────────────┘
```

---

## 🔒 보안 보증

### 절대 서버로 전송되지 않는 데이터
- ❌ 원본 Excel 파일
- ❌ 거래처명
- ❌ 은행명
- ❌ 담당자 정보

### 서버로 전송되는 데이터 (최소한만)
- ✅ 통화코드 (USD, EUR 등)
- ✅ 금액
- ✅ 날짜 (결제예정일)

---

## 🛠️ 기술 구현

### 사용된 API
- **File System Access API**: Chrome/Edge 86+ 지원
- **IndexedDB**: 폴더 핸들 영구 저장
- **localStorage**: 설정 플래그 저장

### 핵심 함수

#### `selectWorkspaceFolder()`
```javascript
// 최상위 폴더 선택 + HEDGEFREEDOM 구조 자동 생성
1. showDirectoryPicker()로 최상위 폴더 선택
2. rootHandle.getDirectoryHandle('HEDGEFREEDOM', {create: true})
3. 하위 폴더들 자동 생성 (원본, 결과, 히스토리, 캐시)
4. IndexedDB에 폴더 핸들 저장
5. UI 상태 업데이트
```

#### `completeMandatoryFolderSetup()`
```javascript
// 설정 완료 처리
1. 원본/결과 폴더 핸들 확인
2. localStorage에 'hedge_folders_setup' 플래그 저장
3. 모달 닫기
4. 목표 헤지 비율 설정 모달로 이동
```

---

## ⚠️ 사용 제약사항

### 브라우저
- ✅ Chrome 86+
- ✅ Edge 86+
- ❌ Firefox (File System Access API 미지원)
- ❌ Safari (File System Access API 미지원)

### 프로토콜
- ✅ HTTPS (필수)
- ✅ localhost (개발 환경)
- ❌ HTTP (보안상 차단)

### Codespaces 환경
- 포트를 **"Public"**으로 변경 필요
- **HTTPS** URL 사용 필수
  - ❌ http://localhost:9000
  - ✅ https://xxx-9000.app.github.dev

---

## 🎨 UI/UX 디자인 원칙

### 신뢰 구축
1. **투명성**: 데이터 흐름을 명확히 시각화
2. **보안 강조**: 민감정보 보호 메시지 강조
3. **간편성**: 단 한 번의 클릭으로 모든 구조 자동 생성

### 시각적 요소
- 📂 폴더 구조 미리보기 (ASCII 트리)
- 🔄 데이터 흐름도 (5단계 표시)
- 🔒 보안 보증 목록 (체크리스트 형식)
- ✅ 완료 상태 표시 (애니메이션)

---

## 📊 모달 구성 요소

### 1. 헤더
- 타이틀: "🎯 작업공간 설정 (단 한 번만!)"
- 서브타이틀: "여러분의 데이터, 여러분이 관리합니다"
- 배경: 블루-인디고 그라데이션

### 2. 핵심 철학 (파란 박스)
- 데이터 주권
- 최소 전송
- 자동 복원
- 간편 설정

### 3. 폴더 구조 미리보기 (회색 박스)
- ASCII 트리 형식
- 자동 생성 강조

### 4. 작업 폴더 선택 버튼 (녹색 박스)
- "📁 작업 폴더 선택하기" 버튼
- 상태 표시 영역

### 5. 데이터 흐름 설명 (보라 박스)
- 5단계 프로세스
- 번호 표시

### 6. 보안 보증 (녹색 사이드바)
- 체크리스트 형식
- 5개 항목

### 7. 완료 버튼
- 초기 상태: "⏳ 작업 폴더를 선택해주세요" (비활성)
- 완료 후: "✅ 설정 완료 및 시작하기" (활성)

### 8. 도움말
- 브라우저 요구사항
- HTTPS 필요성
- Codespaces 가이드

---

## 🧪 테스트 시나리오

### 정상 흐름
```
1. 모달 표시 확인
2. "작업 폴더 선택하기" 클릭
3. Documents 폴더 선택
4. HEDGEFREEDOM 폴더 자동 생성 확인
5. 하위 폴더 4개 생성 확인
6. 완료 버튼 활성화 확인
7. "설정 완료 및 시작하기" 클릭
8. 목표 헤지 비율 모달로 이동 확인
```

### 오류 시나리오
```
1. HTTP로 접속 시 → 오류 메시지 표시
2. Firefox 사용 시 → 브라우저 미지원 안내
3. 폴더 선택 취소 시 → "취소되었습니다" 메시지
4. 완료 버튼을 폴더 선택 전 클릭 시 → 경고 메시지
```

---

## 📝 구현 완료 사항

✅ `selectWorkspaceFolder()` 함수 구현
✅ 자동 폴더 생성 로직 구현
✅ 모달 UI 완전 재작성
✅ `completeMandatoryFolderSetup()` 함수 업데이트
✅ 신뢰 구축 메시지 강화
✅ 데이터 흐름 시각화

---

## 🚀 다음 단계

1. HTTPS 환경에서 테스트
2. 실제 폴더 생성 확인
3. IndexedDB 저장 확인
4. 다음 로그인 시 자동 복원 테스트
5. 오류 처리 검증

---

## 📚 참고 문서

- [FOLDER-WORKFLOW.md](FOLDER-WORKFLOW.md) - 폴더 기반 워크플로우
- [UPLOAD-FLOW.md](UPLOAD-FLOW.md) - Excel 업로드 및 익명화 흐름
- [LOCAL-FOLDER-GUIDE.md](LOCAL-FOLDER-GUIDE.md) - 로컬 폴더 가이드

---

## 🎉 기대 효과

### 고객 신뢰 향상
- 데이터 주권 명확화
- 보안 프로세스 투명화
- 간편한 설정 프로세스

### 운영 효율성
- 자동 폴더 구조 생성
- 수동 폴더 생성 오류 제거
- 일관된 폴더 구조 유지

### 사용자 경험
- 단 한 번의 클릭으로 설정 완료
- 복잡한 폴더 구조 이해 불필요
- 다음 로그인부터 즉시 사용 가능
