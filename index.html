<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="refresh" content="0; url=01 í—¤ì§€ë§¤ë‹ˆì €.html">
    <title>HedgeFreedom - ë©”ì¸ ëŒ€ì‹œë³´ë“œ</title>
</head>
<body>
    <p style="font-family: sans-serif; text-align: center; margin-top: 50px;">
        ë©”ì¸ ëŒ€ì‹œë³´ë“œë¡œ ì´ë™ ì¤‘... 
        <a href="01 í—¤ì§€ë§¤ë‹ˆì €.html" style="color: blue;">í´ë¦­í•˜ì—¬ ì´ë™</a>
    </p>
</body>
</html>
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            font-size: 24px;
            font-weight: bold;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-50 to-gray-100 min-h-screen">
    
    <!-- í—¤ë” -->
    <header class="bg-white border-b border-gray-200 px-6 py-4">
        <div class="flex items-center justify-between">
            <div>
                <h1 class="text-2xl font-bold text-gray-800">HedgeFreedom ê²½ëŸ‰ í”Œë«í¼</h1>
                <p class="text-sm text-gray-500 mt-1">
                    <span class="inline-flex items-center gap-2">
                        <span class="w-2 h-2 bg-green-500 rounded-full"></span>
                        <strong>Zero Storage:</strong> ëª¨ë“  ë°ì´í„°ëŠ” ë¸Œë¼ìš°ì €ì—ì„œë§Œ ì²˜ë¦¬ë©ë‹ˆë‹¤
                    </span>
                </p>
            </div>
            <div class="text-right">
                <div class="text-xs text-gray-400">ë³´ì•ˆ ìƒíƒœ</div>
                <div id="securityStatus" class="text-sm font-semibold text-green-600">
                    ì„¸ì…˜ ìŠ¤í† ë¦¬ì§€ (ì„œë²„ ì €ì¥ ì—†ìŒ)
                </div>
                <button onclick="showSecurityInfo()" class="text-xs text-blue-600 hover:underline mt-1">
                    ìƒì„¸ ì •ë³´
                </button>
            </div>
        </div>
    </header>

    <!-- ë©”ì¸ ì»¨í…ì¸  -->
    <main class="container mx-auto px-6 py-8 max-w-6xl">
        
        <!-- 1. ë°ì´í„° ì—…ë¡œë“œ ì„¹ì…˜ -->
        <section class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6">
            <h2 class="text-lg font-bold text-gray-800 mb-4">ğŸ“ 1ë‹¨ê³„: ë°ì´í„° ì…ë ¥</h2>
            
            <!-- ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì˜ì—­ -->
            <div id="dropZone" class="border-2 border-dashed border-gray-300 rounded-lg p-12 text-center hover:border-blue-400 hover:bg-blue-50 transition cursor-pointer">
                <div class="text-4xl mb-4">ğŸ“Š</div>
                <p class="text-gray-700 font-semibold mb-2">Excel, CSV íŒŒì¼ì„ ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì„¸ìš”</p>
                <p class="text-sm text-gray-500">ìµœëŒ€ 50MB, ì§€ì› í˜•ì‹: .xlsx, .xls, .csv, .json</p>
                <input type="file" id="fileInput" accept=".xlsx,.xls,.csv,.json" class="hidden">
            </div>

            <!-- ìƒ˜í”Œ ë°ì´í„° ë²„íŠ¼ -->
            <div class="mt-4">
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-3 mb-3 text-center">
                    <a href="sample-generator.html" target="_blank" 
                       class="inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm font-semibold">
                        ğŸ“¥ ìƒ˜í”Œ Excel íŒŒì¼ ë‹¤ìš´ë¡œë“œ (ê¶Œì¥)
                    </a>
                    <div class="text-xs text-blue-600 mt-2">20ê±´ì˜ ë¯¸ê²°ì œ ë¦¬ìŠ¤íŠ¸ + ì€í–‰ ì”ì•¡ + ë”ì¡´ í˜•ì‹</div>
                </div>
                <div class="text-center">
                    <button onclick="loadSampleData(event)" class="px-4 py-2 bg-gray-100 border border-gray-300 rounded hover:bg-gray-200 text-sm font-medium">
                        ë˜ëŠ” ê°„ë‹¨í•œ ìƒ˜í”Œë¡œ ë°”ë¡œ í…ŒìŠ¤íŠ¸
                    </button>
                </div>
            </div>

            <!-- ì—…ë¡œë“œëœ íŒŒì¼ ì •ë³´ -->
            <div id="fileInfo" class="mt-4 hidden">
                <div class="bg-blue-50 border border-blue-200 rounded p-4">
                    <div class="flex items-center justify-between">
                        <div>
                            <div class="text-sm font-semibold text-blue-900">ì—…ë¡œë“œ ì™„ë£Œ</div>
                            <div id="fileName" class="text-xs text-blue-700 mt-1"></div>
                        </div>
                        <button onclick="clearData()" class="text-xs text-red-600 hover:underline">ì‚­ì œ</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- 2. ë¦¬ìŠ¤í¬ ë¶„ì„ ê²°ê³¼ -->
        <section id="analysisSection" class="hidden">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                
                <!-- KPI ì¹´ë“œë“¤ -->
                <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                    <div class="text-xs text-gray-500 font-semibold uppercase mb-2">VaR 95% (ìµœëŒ€ ì˜ˆìƒ ì†ì‹¤)</div>
                    <div id="varValue" class="text-3xl font-bold text-red-600">-</div>
                    <div class="text-xs text-gray-400 mt-1">1ì¼ ë³´ìœ  ê¸°ê°„ ê¸°ì¤€</div>
                </div>

                <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                    <div class="text-xs text-gray-500 font-semibold uppercase mb-2">ìˆœ ë…¸ì¶œì•¡ (Net Exposure)</div>
                    <div id="netExposureValue" class="text-3xl font-bold text-blue-600">-</div>
                    <div class="text-xs text-gray-400 mt-1">ì „ì²´ í†µí™” í•©ì‚°</div>
                </div>

                <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                    <div class="text-xs text-gray-500 font-semibold uppercase mb-2">í—¤ì§€ ë¹„ìœ¨</div>
                    <div id="hedgeRatioValue" class="text-3xl font-bold text-gray-700">-</div>
                    <div class="w-full bg-gray-200 h-2 rounded-full mt-3">
                        <div id="hedgeRatioBar" class="bg-green-500 h-2 rounded-full" style="width: 0%"></div>
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                    <div class="text-xs text-gray-500 font-semibold uppercase mb-2">ë¦¬ìŠ¤í¬ ìƒíƒœ</div>
                    <div id="riskStatus" class="text-2xl font-bold">-</div>
                    <div id="riskStatusMsg" class="text-xs text-gray-500 mt-2">-</div>
                </div>
            </div>

            <!-- í†µí™”ë³„ ìƒì„¸ -->
            <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6">
                <h3 class="text-lg font-bold text-gray-800 mb-4">í†µí™”ë³„ ë¶„ì„</h3>
                <div id="currencyTable" class="overflow-x-auto">
                    <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
                </div>
            </div>

            <!-- ì•¡ì…˜ ë²„íŠ¼ -->
            <div class="flex gap-4">
                <button onclick="exportPDF()" class="px-6 py-3 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 transition">
                    ğŸ“„ PDF ë¦¬í¬íŠ¸ ë‹¤ìš´ë¡œë“œ
                </button>
                <button onclick="exportExcel()" class="px-6 py-3 bg-green-600 text-white rounded-lg font-semibold hover:bg-green-700 transition">
                    ğŸ“Š Excel ë‹¤ìš´ë¡œë“œ
                </button>
                <button onclick="exportBackup()" class="px-6 py-3 bg-gray-600 text-white rounded-lg font-semibold hover:bg-gray-700 transition">
                    ğŸ’¾ ì•”í˜¸í™” ë°±ì—…
                </button>
            </div>
        </section>

        <!-- ë³´ì•ˆ ì•ˆë‚´ -->
        <div class="mt-8 bg-green-50 border border-green-200 rounded-lg p-6">
            <h3 class="font-bold text-green-900 mb-2">ğŸ”’ ë°ì´í„° ë³´ì•ˆ ì •ì±…</h3>
            <ul class="text-sm text-green-800 space-y-1">
                <li>âœ… ëª¨ë“  ë°ì´í„°ëŠ” ê·€í•˜ì˜ ë¸Œë¼ìš°ì €ì—ì„œë§Œ ì²˜ë¦¬ë©ë‹ˆë‹¤</li>
                <li>âœ… ì„œë²„ì— ì–´ë– í•œ ë°ì´í„°ë„ ì „ì†¡ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤</li>
                <li>âœ… ë¸Œë¼ìš°ì € ì¢…ë£Œ ì‹œ ëª¨ë“  ë°ì´í„°ê°€ ìë™ìœ¼ë¡œ ì‚­ì œë©ë‹ˆë‹¤</li>
                <li>âœ… ì„ íƒì ìœ¼ë¡œ AES-256 ì•”í˜¸í™”ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</li>
            </ul>
        </div>
    </main>

    <!-- JavaScript -->
    <script src="core/storage-manager.js"></script>
    <script src="core/data-loader.js"></script>
    <script src="core/risk-calculator.js"></script>
    <script src="core/hedge-analysis-engine.js"></script>
    
    <script>
        // ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì„¤ì •
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');

        dataLoader.setupDragAndDrop(dropZone, handleFileLoaded);

        dropZone.addEventListener('click', () => fileInput.click());
        fileInput.addEventListener('change', async (e) => {
            if (e.target.files.length > 0) {
                try {
                    const result = await dataLoader.loadFile(e.target.files[0]);
                    handleFileLoaded(result);
                    // íŒŒì¼ ì…ë ¥ ì´ˆê¸°í™” (ê°™ì€ íŒŒì¼ ì¬ì„ íƒ ê°€ëŠ¥)
                    e.target.value = '';
                } catch (error) {
                    alert(error.message);
                }
            }
        });

        // íŒŒì¼ ë¡œë“œ ì™„ë£Œ í•¸ë“¤ëŸ¬
        function handleFileLoaded(data) {
            console.log('íŒŒì¼ ë¡œë“œ ì™„ë£Œ:', data);
            
            document.getElementById('fileInfo').classList.remove('hidden');
            document.getElementById('fileName').textContent = data.fileName || 'Unknown';
            
            try {
                // í‘œì¤€ í˜•ì‹ìœ¼ë¡œ ë³€í™˜
                let standardData;
                
                if (data.type === 'excel' && data.sheets) {
                    // Excel: ì²« ë²ˆì§¸ ì‹œíŠ¸ ì‚¬ìš©
                    const firstSheetName = Object.keys(data.sheets)[0];
                    const sheetData = data.sheets[firstSheetName];
                    console.log(`Excel ì‹œíŠ¸ ì‚¬ìš©: ${firstSheetName}, ${sheetData.length}í–‰`);
                    standardData = dataLoader.convertToStandardFormat({ type: 'excel', data: sheetData });
                } else if (data.type === 'csv' && data.data) {
                    standardData = dataLoader.convertToStandardFormat(data);
                } else if (data.data) {
                    standardData = data.data;
                } else {
                    throw new Error('ë°ì´í„° í˜•ì‹ì„ ì¸ì‹í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                }
                
                console.log('í‘œì¤€ í˜•ì‹ ë³€í™˜ ì™„ë£Œ:', standardData);
                
                if (!standardData || (Array.isArray(standardData) && standardData.length === 0)) {
                    throw new Error('ë³€í™˜ëœ ë°ì´í„°ê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤');
                }
                
                // ë¦¬ìŠ¤í¬ ë¶„ì„ ì‹¤í–‰
                analyzeRisk(standardData);
            } catch (error) {
                console.error('ë°ì´í„° ì²˜ë¦¬ ì˜¤ë¥˜:', error);
                alert('ë°ì´í„° ì²˜ë¦¬ ì‹¤íŒ¨: ' + error.message + '\n\nì½˜ì†”(F12)ì—ì„œ ìƒì„¸ ë‚´ìš©ì„ í™•ì¸í•˜ì„¸ìš”.');
            }
        }

        // ìƒ˜í”Œ ë°ì´í„° ë¡œë“œ
        function loadSampleData(event) {
            if (event) event.stopPropagation();
            const sampleData = dataLoader.generateSampleData();
            handleFileLoaded({ fileName: 'sample_data.json', data: sampleData });
        }

        // ë¦¬ìŠ¤í¬ ë¶„ì„
        function analyzeRisk(data) {
            const report = riskCalculator.generateRiskReport(data);
            
            // ë¶„ì„ ì—”ì§„ì— ë°ì´í„° ë¡œë“œ ë° ì „ì²´ ë¶„ì„ ì‹¤í–‰
            hedgeAnalysisEngine.loadData(data);
            const analysisResults = hedgeAnalysisEngine.runFullAnalysis({
                timeHorizon: 90,
                currentRates: {
                    'USD': 1350,
                    'EUR': 1450,
                    'JPY': 9.5,
                    'CNY': 185
                },
                operatingProfit: 5000000000  // 50ì–µ ê°€ì •
            });
            
            // UI ì—…ë°ì´íŠ¸ (ë¶„ì„ ì—”ì§„ ê²°ê³¼ ì‚¬ìš©)
            document.getElementById('analysisSection').classList.remove('hidden');
            
            // VaR (ê¸°ì¡´ ê³„ì‚°ê¸° ì‚¬ìš©)
            document.getElementById('varValue').textContent = 
                'â‚©' + report.var.totalVaR.toLocaleString();
            
            // ìˆœ ë…¸ì¶œì•¡ (ë¶„ì„ ì—”ì§„ ì‚¬ìš©)
            const netExp = analysisResults.netExposure;
            let totalNet = 0;
            Object.keys(netExp.summary).forEach(currency => {
                totalNet += Math.abs(netExp.summary[currency].net);
            });
            document.getElementById('netExposureValue').textContent = 
                '$' + totalNet.toLocaleString();
            
            // í—¤ì§€ ë¹„ìœ¨ (ì •ì±… ì¤€ìˆ˜ ë°ì´í„°)
            const compliance = analysisResults.compliance;
            document.getElementById('hedgeRatioValue').textContent = 
                compliance.overall.hedgeRatio.toFixed(1) + '%';
            document.getElementById('hedgeRatioBar').style.width = 
                compliance.overall.hedgeRatio + '%';
            
            // ë¦¬ìŠ¤í¬ ìƒíƒœ (ì •ì±… ì¤€ìˆ˜ ê¸°ë°˜)
            const statusMap = {
                'COMPLIANT': { text: 'âœ… ì–‘í˜¸', color: 'green' },
                'ATTENTION': { text: 'âš ï¸ ì£¼ì˜', color: 'yellow' },
                'WARNING': { text: 'ğŸ”¶ ê²½ê³ ', color: 'orange' },
                'CRITICAL': { text: 'ğŸ”´ ìœ„í—˜', color: 'red' }
            };
            const status = statusMap[compliance.overall.status] || { text: 'ì ê²€', color: 'gray' };
            document.getElementById('riskStatus').textContent = status.text;
            document.getElementById('riskStatus').className = 
                `text-2xl font-bold text-${status.color}-600`;
            document.getElementById('riskStatusMsg').textContent = 
                `ìœ„ë°˜ ì‚¬í•­: ${compliance.overall.violations.length}ê±´`;
            
            // í†µí™”ë³„ í…Œì´ë¸” (ë¶„ì„ ì—”ì§„ ë°ì´í„°)
            renderCurrencyTable(analysisResults);
            
            // ì„¸ì…˜ì— ì „ì²´ ë¶„ì„ ì €ì¥
            storageManager.saveData('latestAnalysis', analysisResults);
            
            // ì½˜ì†”ì— ìƒì„¸ ì¶œë ¥
            console.log('=== ì „ì‚¬ í†µí•© ìˆœ ë…¸ì¶œ í˜„í™© ===');
            console.log(analysisResults.netExposure);
            console.log('=== í™˜ìœ¨ ë³€ë™ ìŠ¤íŠ¸ë ˆìŠ¤ í…ŒìŠ¤íŠ¸ ===');
            console.log(analysisResults.sensitivity);
            console.log('=== ë¦¬ìŠ¤í¬ ì •ì±… ì¤€ìˆ˜ìœ¨ ===');
            console.log(analysisResults.compliance);
            console.log('=== ìµœì  í—¤ì§€ ì‹¤í–‰ ì œì•ˆì„œ ===');
            console.log(analysisResults.hedgeProposal);
        }

        // í†µí™”ë³„ í…Œì´ë¸” ë Œë”ë§ (ë¶„ì„ ì—”ì§„ ë°ì´í„° ì‚¬ìš©)
        function renderCurrencyTable(analysisResults) {
            const netExp = analysisResults.netExposure;
            const compliance = analysisResults.compliance;
            
            const table = document.getElementById('currencyTable');
            let html = '<table class="w-full text-sm"><thead class="bg-gray-50"><tr>';
            html += '<th class="px-4 py-2 text-left">í†µí™”</th>';
            html += '<th class="px-4 py-2 text-right">ë“¤ì–´ì˜¬ ëˆ</th>';
            html += '<th class="px-4 py-2 text-right">ë‚˜ê°ˆ ëˆ</th>';
            html += '<th class="px-4 py-2 text-right">ìˆœ ë…¸ì¶œì•¡</th>';
            html += '<th class="px-4 py-2 text-right">í—¤ì§€ ë¹„ìœ¨</th>';
            html += '<th class="px-4 py-2 text-left">í•„ìš” ì•¡ì…˜</th>';
            html += '<th class="px-4 py-2 text-left">ìƒíƒœ</th>';
            html += '</tr></thead><tbody>';
            
            Object.keys(netExp.summary).forEach(currency => {
                const data = netExp.summary[currency];
                const compData = compliance.byCurrency[currency] || {};
                const action = netExp.actionRequired[currency];
                
                const statusColor = compData.status === 'COMPLIANT' ? 'text-green-600' : 'text-red-600';
                const statusIcon = compData.status === 'COMPLIANT' ? 'âœ…' : 'âš ï¸';
                
                const actionBadge = action ? 
                    `<span class="px-2 py-1 rounded text-xs font-semibold ${action.action === 'SELL' ? 'bg-red-100 text-red-700' : 'bg-blue-100 text-blue-700'}">
                        ${action.action} ${action.amount.toLocaleString()}
                    </span>` 
                    : '<span class="text-gray-400">-</span>';
                
                html += `<tr class="border-b hover:bg-gray-50">
                    <td class="px-4 py-2 font-bold">${currency}</td>
                    <td class="px-4 py-2 text-right text-green-600">â‚©${data.inflows.toLocaleString()}</td>
                    <td class="px-4 py-2 text-right text-red-600">â‚©${data.outflows.toLocaleString()}</td>
                    <td class="px-4 py-2 text-right font-bold ${statusColor}">â‚©${data.net.toLocaleString()}</td>
                    <td class="px-4 py-2 text-right">${compData.hedgeRatio?.toFixed(1) || '0.0'}%</td>
                    <td class="px-4 py-2">${actionBadge}</td>
                    <td class="px-4 py-2">
                        <span class="${statusColor}">${statusIcon} ${compData.status || 'N/A'}</span>
                    </td>
                </tr>`;
            });
            
            html += '</tbody></table>';
            table.innerHTML = html;
        }

        // ë³´ì•ˆ ì •ë³´ í‘œì‹œ
        function showSecurityInfo() {
            const status = storageManager.getSecurityStatus();
            alert(`ë³´ì•ˆ ìƒíƒœ:\n\n${JSON.stringify(status, null, 2)}`);
        }

        // ë°ì´í„° í´ë¦¬ì–´
        function clearData() {
            if (confirm('ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                storageManager.clearSession();
                location.reload();
            }
        }

        // ë‚´ë³´ë‚´ê¸° í•¨ìˆ˜ë“¤ (ì‹¤ì œ êµ¬í˜„ í•„ìš”)
        function exportPDF() {
            alert('PDF ìƒì„± ê¸°ëŠ¥ (jsPDF êµ¬í˜„ ì˜ˆì •)');
        }

        function exportExcel() {
            alert('Excel ìƒì„± ê¸°ëŠ¥ (SheetJS êµ¬í˜„ ì˜ˆì •)');
        }

        function exportBackup() {
            const password = prompt('ë°±ì—… íŒŒì¼ ì•”í˜¸í™” ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:');
            if (password) {
                storageManager.exportBackup(password);
            }
        }
    </script>
</body>
</html>
